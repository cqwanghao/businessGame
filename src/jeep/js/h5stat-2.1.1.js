!function(t){function a(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}var e={};a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},a.p="",a(a.s=0)}([function(t,a,e){t.exports=e(1)},function(t,a,e){var r=e(2);t.exports=window.tar=new r},function(t,a,e){function r(){var t=new n,a=new o(t),e=new i(t),r=new s(t);this.init=function(n){t.init(n);var o=!0;(o=t.isWechatEnv()||n.tar_scope?a.init():e.init())&&r.init()},this.ready=function(a){t.cb_ready=a},this.shapeShareAppMessage=function(t){return a.shapeShare(t,"friend")},this.shapeShareTimeline=function(t){return a.shapeShare(t,"timeline")},this.shapeShareQQ=function(t){return a.shapeShare(t,"qq")},this.shapeShareQZone=function(t){return a.shapeShare(t,"qzone")},this.hitTag=function(t,a){r.hitTag(t,a)}}t.exports=r;var n=e(3),o=e(4),i=e(5),s=e(6)},function(t,a){function e(){var t=Math.round(7*Math.random()+2);this.protocol=location.protocol||"http:",this.tar_slb_domain=this.protocol+"//slb"+t+".tarsocial.com";var a=this.protocol+"//api.h5mo.com";this.encrypturl=a+"/v1/wxopen/encrypt",this.shorturl=a+"/v1/wxopen/shorturl",this.hitTagurl=this.tar_slb_domain+"/in/act",this.sendStayurl=this.tar_slb_domain+"/in/wxt",this.posturlold=this.tar_slb_domain+"/in/wxs",this.posturlnew=this.tar_slb_domain+"/in/wxc",this.rc4Key="tar"}t.exports=e,e.prototype.init=function(t){this.tar_init_time=new Date,this.tar_init=!0;Date.parse(this.tar_init_time);this.tar_key="monitor",this.tar_event=this.trim(t.tar_tid),this.tar_debug=!(!t.tar_debug||1!=t.tar_debug)&&t.tar_debug,this.tar_scope=t.tar_scope,this.tar_appid=t.tar_appid,this.tar_userinfo=t.tar_userinfo,this.tar_token=this.trim(t.tar_token),this.scopekey="tar-scope-"+this.tar_event,this.userinfokey="tar-userinfo-"+this.tar_event,this.statekey="tar-state-"+this.tar_event,this.uuidkey="tar-uuid-"+this.tar_event,this.tar_hot_map=t.tar_hot_map,this.tar_init_flag=!1,this.hitData=[],this.tar_differ_time=t.tar_differ_time||2e4,this.cb_ready=null,this.tar_type=t.tar_type||0,this.tar_visit_time_last=parseInt(window.localStorage.getItem("tar_visit_time"))||0,this.tar_wxArticle_data={},window.localStorage.setItem("tar_visit_time",Date.parse(new Date));var a=/micromessenger/i.test(navigator.userAgent);this.oauthurl="http://"+this.tar_appid+".auth.shijisuxie.top/v1/wxopen/wxauth",this.tar_wechat_env=a,this.posturl=this.tar_slb_domain+"/in/wxc";var e=window.localStorage.getItem(this.uuidkey);void 0===e||null==e||""==e?(e=this.getCookie(this.uuidkey),this.tar_oid=void 0===e||null==e||""==e?this.guid():e,/QQ/i.test(navigator.userAgent)&&(this.tar_oid="qq:"+this.tar_oid),window.localStorage.setItem(this.uuidkey,this.tar_oid)):this.tar_oid=e;var r=this.getUrlArgMap();this.tar_foid=r.tar_foid,this.tar_from=r.from,this.tar_channel=r.tar_channel||"";var n="tar-fuuid-"+this.tar_event,o="tar-channel-"+this.tar_event;if(this.tar_foid){var i=this.tar_foid.substring(0,2),s=window.localStorage.getItem(o)||"";s&&"C-"==s.substring(0,2)||"_D"==i||"C-"==i?(this.posturl=this.posturlnew,s&&(this.tar_channel=s),"C-"==i&&(window.localStorage.setItem(o,this.tar_foid),this.tar_channel=this.tar_foid)):this.posturl=this.posturlold,this.tar_foid!=this.tar_oid&&window.localStorage.setItem(n,this.tar_foid)}else this.tar_foid=window.localStorage.getItem(n),this.tar_foid||(this.tar_foid="root");if(this.tar_from){var c="tar-from-"+this.tar_event;window.localStorage.setItem(c,this.tar_from)}else this.tar_wechat_env?this.tar_from="wechat":this.tar_from="other";var u=this.removeUrlParam(location.href,"tar_foid");if(u=this.removeUrlParam(u,"from"),u=this.removeUrlParam(u,"isappinstalled"),u=this.removeUrlParam(u,"timestamp"),u=this.removeUrlParam(u,"userinfo"),this.tar_url=u,this.tar_width=document.documentElement.clientWidth,this.tar_height=document.documentElement.clientHeight,this.setCookieAdv(this.uuidkey,this.tar_oid,365),this.tar_type){document.querySelector("body").style.height="auto";var l=document.querySelector("body").offsetHeight;this.tar_wxArticle_data.height=l,this.tar_wxArticle_data.clientH=document.documentElement.clientHeight,this.tar_wxArticle_data.scrollH={},this.wxArticle()}},e.prototype.wxArticle=function(){var t=this,a=document.body.scrollTop;t.tar_wxArticle_data.scrollH[a]&&void 0!=t.tar_wxArticle_data.scrollH[a]||(t.tar_wxArticle_data.scrollH[a]=0),t.tar_wxArticle_data.scrollH[a]++,setTimeout(function(){t.wxArticle()},1e3)},e.prototype.isWechatEnv=function(){return this.tar_wechat_env},e.prototype.resetOpenid=function(t){this.tar_oid=t,window.localStorage.setItem(this.uuidkey,t),this.setCookieAdv(this.uuidkey,t,365)},e.prototype.loadSword=function(){if(this.tar_hot_map){var t=document.getElementsByTagName("head")[0],a=document.createElement("script"),e=this;a.type="text/javascript",a.async=!0,a.onload=a.onreadystatechange=function(){if(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState){a.onload=a.onreadystatechange=null;var t=window["sword-web"];t&&"function"==typeof t.init&&(console.log(t,"sword-init"),t.init({eventid:e.tar_event,openid:e.tar_oid,debug:e.tar_debug}))}},a.src=e.protocol+"//cdn.tarsocial.com/sword-web/sword-web-min.js?v=33",t.appendChild(a)}},e.prototype.debug=function(t,a){if(this.tar_debug)if(/wxdebugger/i.test(navigator.userAgent)||!this.tar_wechat_env)console.log(t),console.log(a);else{var e=t+"\n";e+="object"==typeof a?JSON.stringify(a):a,alert(e)}},e.prototype.setCookieAdv=function(t,a,e){var r=new Date;r.setDate(r.getDate()+e),document.cookie=t+"="+escape(a)+(null==e?"":";expires="+r.toGMTString())},e.prototype.getCookie=function(t){var a,e=null,r=document.cookie+";",n=t+"=",o=r.indexOf(n);return-1!=o&&(o+=n.length,a=r.indexOf(";",o),e=unescape(r.substring(o,a))),e},e.prototype.guid=function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e.prototype.getUrlArgMap=function(t){var a=new Object,e=location.search.substring(1);if(t){var r=t.split("?");2==r.length&&(e=r[1])}for(var n=e.split("&"),o=0;o<n.length;o++){var i=n[o].indexOf("=");if(-1!=i){var s=n[o].substring(0,i),c=n[o].substring(i+1);a[s]=unescape(c)}}return a},e.prototype.removeUrlParam=function(t,a){var e="",r="",n=t.indexOf("#");if(-1!=n&&(r=t.substr(n)),-1==t.indexOf("?"))return t+r;e=t.substr(t.indexOf("?")+1);var o="",i="",s="";if(-1!=e.indexOf("&")){o=e.split("&");for(var c in o)if(o.hasOwnProperty(c)){var u=o[c].indexOf("="),l=o[c].substring(0,u),d=o[c].substring(u+1,o[c].length);l!=a&&(i=i+l+"="+d+"&")}s=t.substr(0,t.indexOf("?"))+"?"+i.substr(0,i.length-1)}else o=e.split("="),s=o[0]==a?t.substr(0,t.indexOf("?")):t;return s+r},e.prototype.Ajax=function(){function t(t,r){function n(){}var o=!1!==r.async,i=r.method||"GET",s=r.data||null,c=r.success||n,u=r.failure||n;i=i.toUpperCase(),"GET"==i&&s&&(s=e(s),t+=(-1==t.indexOf("?")?"?":"&")+s,s=null),t+=(-1==t.indexOf("?")?"?":"&")+"t="+Date.parse(new Date)/1e3;var l=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return l.onreadystatechange=function(){a(l,c,u)},l.open(i,t,o),"POST"==i&&(s=e(s),l.setRequestHeader("Content-type","application/x-www-form-urlencoded;")),l.send(s),l}function a(t,a,e){if(4==t.readyState){var r=t.status;r>=200&&r<300?a(t):e(t)}}function e(t){if("string"==typeof t||null==t)return t;if("object"==typeof t){var a="";for(var e in t)a="&"+e+"="+t[e]+a;return a.substr(1)}return t.toString()}return{request:t}}(),e.prototype.urlencode=function(t){return t=(t+"").toString(),encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%2B/g,"+").replace(/%252B/g,"+")},e.prototype.str_replace=function(t,a,e,r){var n=0,o=0,i="",s="",c=0,u=0,l=[].concat(t),d=[].concat(a),_=e,h=d instanceof Array,m=_ instanceof Array;for(_=[].concat(_),r&&(this.window[r]=0),n=0,c=_.length;n<c;n++)if(""!==_[n])for(o=0,u=l.length;o<u;o++)i=_[n]+"",s=h?void 0!==d[o]?d[o]:"":d[0],_[n]=i.split(l[o]).join(s),r&&_[n]!==i&&(this.window[r]+=(i.length-_[n].length)/l[o].length);return m?_:_[0]},e.prototype.utf8to16=function(t){var a,e,r,n,o,i;for(a="",r=t.length,e=0;e<r;)switch((n=t.charCodeAt(e++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=t.charAt(e-1);break;case 12:case 13:o=t.charCodeAt(e++),a+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=t.charCodeAt(e++),i=t.charCodeAt(e++),a+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&i)<<0)}return a},e.prototype.base64decode=function(t){var a,e,r,n,o,i,s,c=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);for(i=t.length,o=0,s="";o<i;){do{a=c[255&t.charCodeAt(o++)]}while(o<i&&-1==a);if(-1==a)break;do{e=c[255&t.charCodeAt(o++)]}while(o<i&&-1==e);if(-1==e)break;s+=String.fromCharCode(a<<2|(48&e)>>4);do{if(61==(r=255&t.charCodeAt(o++)))return s;r=c[r]}while(o<i&&-1==r);if(-1==r)break;s+=String.fromCharCode((15&e)<<4|(60&r)>>2);do{if(61==(n=255&t.charCodeAt(o++)))return s;n=c[n]}while(o<i&&-1==n);if(-1==n)break;s+=String.fromCharCode((3&r)<<6|n)}return s},e.prototype.rc4=function(t,a){for(var e,r=[],n=0,o="",i=0;i<256;i++)r[i]=i;for(i=0;i<256;i++)n=(n+r[i]+t.charCodeAt(i%t.length))%256,e=r[i],r[i]=r[n],r[n]=e;i=0,n=0;for(var s=0;s<a.length;s++)i=(i+1)%256,n=(n+r[i])%256,e=r[i],r[i]=r[n],r[n]=e,o+=String.fromCharCode(a.charCodeAt(s)^r[(r[i]+r[n])%256]);return o},e.prototype.trim=function(t){return isNaN(t)?t.replace(/(^\s*)|(\s*$)/g,""):t}},function(module,exports){function TarWXShare(tarCommon){var Ajax=tarCommon.Ajax,tar_slb_domain="",tar_event="",tar_foid="",tar_oid="",tar_nickname="",tar_sex="",tar_province="",tar_city="",tar_country="",tar_headimgurl="",tar_unionid="",tar_uuid="",tar_encrypt="",tar_sharedata="",tar_sign="",tar_timestamp="",timeNow=Date.parse(new Date)/1e3+"",reSetUserinfo=function(t){void 0!==t&&null!=t&&(tar_oid=t.openid,tar_nickname=t.nickname,tar_sex=t.sex,tar_province=t.province,tar_city=t.city,tar_country=t.country,tar_headimgurl=t.headimgurl,tar_unionid=t.unionid,window.localStorage.setItem("tar_userinfo",JSON.stringify(t)),tarCommon.resetOpenid(tar_oid))},__submitAccess=function(){var t=tarCommon.tar_from,a=tarCommon.tar_url,e=tarCommon.tar_refer,r=tarCommon.tar_width,n=tarCommon.tar_height,o=tarCommon.tar_channel,i=tarCommon.tar_token,s=tarCommon.tar_key;void 0!==tar_foid&&null!=tar_foid&&""!=tar_foid||(tar_foid="root"),void 0!==tar_oid&&null!=tar_oid||(tar_oid=""),void 0!==tar_nickname&&null!=tar_nickname||(tar_nickname=""),void 0!==tar_sex&&null!=tar_sex||(tar_sex=""),void 0!==tar_province&&null!=tar_province||(tar_province=""),void 0!==tar_city&&null!=tar_city||(tar_city=""),void 0!==tar_country&&null!=tar_country||(tar_country=""),void 0!==tar_headimgurl&&null!=tar_headimgurl||(tar_headimgurl=""),void 0!==t&&null!=t||(t=""),void 0!==tar_unionid&&null!=tar_unionid||(tar_unionid=""),void 0!==a&&null!=a||(a=""),void 0!==e&&null!=e||(e=""),void 0!==r&&null!=r||(r=""),void 0!==n&&null!=n||(n=""),void 0!==tar_uuid&&null!=tar_uuid||(tar_uuid="");var c={tar_uuid:tar_uuid,tar_event:tar_event,tar_oid:tar_oid,tar_foid:tar_foid,tar_nickname:tar_nickname,tar_sex:tar_sex,tar_province:tar_province,tar_city:tar_city,tar_country:tar_country,tar_headimgurl:tar_headimgurl,tar_from:t,tar_unionid:tar_unionid,tar_url:a,tar_refer:e,tar_width:r,tar_height:n,tar_nettype:"",tar_channel:o,tar_token:i,tar_epkey:s};console.log("发送数据",c),tarCommon.loadSword(),tarCommon.debug("TarWXShare __submit data",c),Ajax.request(tarCommon.posturlnew,{method:"POST",data:c,success:function(t){tarCommon.debug("TarWXShare __submitAccess","wechat access finish"),tarCommon.cb_ready&&(console.log("执行ready"+tarCommon.cb_ready),tarCommon.cb_ready()),tarCommon.tar_init_flag=!0},failure:function(t){console.log("TarWXShare failure",t),tarCommon.debug("TarWXShare failure",t)}})};this.init=function(){if(tar_oid=tarCommon.tar_oid,tar_uuid=tarCommon.tar_uuid,tar_foid=tarCommon.tar_foid,tar_event=tarCommon.tar_event,tar_slb_domain=tarCommon.tar_slb_domain,shorturl=tarCommon.shorturl,!tarCommon.tar_scope)return this.__configUserinfo(tarCommon.tar_userinfo),!0;var t=tarCommon.getUrlArgMap(),a=t.userinfo,e=this.base64Decode(a);tarCommon.debug("TarWXShare init userinfo_64 and url",a+"\n"+window.location.href);var r=window.localStorage.getItem(tarCommon.scopekey);r!=tarCommon.tar_scope&&window.localStorage.setItem(tarCommon.scopekey,tarCommon.tar_scope);var n=Date.parse(new Date)-tarCommon.tar_visit_time_last;if(r&&"snsapi_base"==r&&"snsapi_userinfo"==tarCommon.tar_scope)return tarCommon.debug("TarWXShare init","scope changed"),this.__requestOauth();var o=window.localStorage.getItem(tarCommon.statekey);if(tarCommon.debug("TarWXShare init localState",o),n>=tarCommon.tar_differ_time||!o||"undefined"==o)return tarCommon.debug("TarWXShare init","no local state"),this.__requestOauth();if("1"==o){if(!a)return this.__requestOauth();window.localStorage.setItem(tarCommon.statekey,"2"),window.localStorage.setItem(tarCommon.userinfokey,a)}else if("2"==o){tarCommon.debug("TarWXShare init localState 2 start",o);var i=window.localStorage.getItem(tarCommon.userinfokey);if(""==i||!i||"undefined"==i||null==i)return tarCommon.debug("TarWXShare init __requestOauth start",i),this.__requestOauth();var s=this.base64Decode(i);if(tarCommon.debug("TarWXShare init localUserinfo",s),!s.openid)return tarCommon.debug("TarWXShare init","no local userinfo openid"),this.__requestOauth();if(!a){tarCommon.debug("TarWXShare init","redirect for bringing userinfo");var c=window.location.href,u=window.location.hash;return c=c.substr(0,c.length-u.length),c=/\?/i.test(c)?c+"&userinfo="+i:c+"?userinfo="+i,window.location.href=c+u,window.event&&(window.event.returnValue=!1),!1}if(s.openid!=e.openid)return tarCommon.debug("TarWXShare init","local openid not equal openid of url"),this.__requestOauth()}reSetUserinfo(e),__submitAccess();var l={tar_eventid:tar_event,tar_oid:tar_oid,tar_foid:tar_foid};return this.postEncrypt(l),!0},this.__requestOauth=function(){window.localStorage.setItem(tarCommon.statekey,"1");var t=window.location.href,a=tarCommon.removeUrlParam(t,"code");if(a=tarCommon.removeUrlParam(a,"userinfo"),"snsapi_base"==tarCommon.tar_scope){var e=tarCommon.urlencode(a),r=tarCommon.oauthurl+"?appid="+tarCommon.tar_appid+"&scope=snsapi_base&callback="+e;return window.location.href=r,window.event&&(window.event.returnValue=!1),!1}if("snsapi_userinfo"==tarCommon.tar_scope){var e=tarCommon.urlencode(a),r=tarCommon.oauthurl+"?appid="+tarCommon.tar_appid+"&scope=snsapi_userinfo&callback="+e;return window.location.href=r,window.event&&(window.event.returnValue=!1),!1}return"snsapi_none"!=tarCommon.tar_scope||(tarCommon.debug("TarWXShare init no oauth",tarCommon.tar_scope),!0)},this.__configUserinfo=function(t){if(t&&t[0]&&t[0].openid){var a=t[0];console.log(a),void 0!==a&&null!=a&&(reSetUserinfo(a),window.localStorage.setItem(tarCommon.userinfokey,JSON.stringify(a)))}__submitAccess();var e={tar_eventid:tar_event,tar_oid:tar_oid,tar_foid:tar_foid};this.postEncrypt(e),tarCommon.debug("TarWXShare config","openid: "+tar_oid+"\nfopenid: "+tar_foid)},this.shapeShare=function(data_in,share_kind){if(!tarCommon.isWechatEnv())return data_in;tarCommon.debug("TarWXShare shapeShare "+share_kind,data_in);var data=new Object;for(var key in data_in)data_in.hasOwnProperty(key)&&(data[key]=data_in[key]);void 0!==tar_oid&&null!=tar_oid||(tar_oid="");var data_trigger="null";"function"==typeof data.trigger&&(data_trigger=data.trigger);var trigger=function(){if(tarCommon.debug("TarWXShare shapeShare trigger "+share_kind," share start"),"null"!=data_trigger){var trigger_callback_string=data_trigger.toString(),trigger_callback=eval("new "+trigger_callback_string);"function"==typeof trigger_callback&&trigger_callback()}};data.trigger=trigger;var data_success="null";"function"==typeof data.success&&(data_success=data.success);var postdata={tar_event:tar_event,tar_oid:tar_oid,tar_nickname:tar_nickname,tar_kind:share_kind,tar_sign:tar_sign,tar_timestamp:tar_timestamp,tar_status:"null",tar_channel:tarCommon.tar_channel,tar_epkey:tarCommon.tar_key};console.log("postdata",postdata);var success=function(){if(postdata.tar_status="success",tarCommon.tar_type){var h=document.body.scrollTop;postdata.tar_position=h}tarCommon.debug("TarWXShare shapeShare success "+share_kind,postdata),Ajax.request(tar_slb_domain+"/in/wxf",{method:"POST",data:postdata,success:function(){if("null"!=data_success){var succ_callback_string=data_success.toString(),succ_callback=eval("new "+succ_callback_string);"function"==typeof succ_callback&&succ_callback()}},failure:function(){if("null"!=data_success){var succ_callback_string=data_success.toString(),succ_callback=eval("new "+succ_callback_string);"function"==typeof succ_callback&&succ_callback()}}})};data.success=success;var data_cancel="null";"function"==typeof data.cancel&&(data_cancel=data.cancel);var cancel=function(){postdata.tar_status="cancel",tarCommon.debug("TarWXShare shapeShare cancel "+share_kind,postdata),Ajax.request(tar_slb_domain+"/in/wxf",{method:"POST",data:postdata,success:function(){if("null"!=data_cancel){var cancel_callback_string=data_cancel.toString(),cancel_callback=eval("new "+cancel_callback_string);"function"==typeof cancel_callback&&cancel_callback()}},failure:function(){if("null"!=data_cancel){var cancel_callback_string=data_cancel.toString(),cancel_callback=eval("new "+cancel_callback_string);"function"==typeof cancel_callback&&cancel_callback()}}})};return data.cancel=cancel,data.type=1,shapeShareData(data,share_kind)};var shapeShareData=function(t,a){var e=tarCommon.getUrlArgMap(),r=e.tar_shareid;void 0!==r&&null!=r||(r=""),void 0!==tar_foid&&null!=tar_foid&&""!=tar_foid||(tar_foid="root");var n=tar_encrypt,o=tar_sharedata,i=n&&n.length>0?n:tar_oid;o&&(o.share_img&&(t.imgUrl=o.share_img),o.share_desc&&(t.desc=o.share_desc),o.share_title&&(t.title=o.share_title),o.share_link&&(t.link=o.share_link));var s=t.link.trim(),c=!1;return/^https:\/\/open.weixin.qq.com\//.test(s)&&(t.link=decodeURIComponent(tarCommon.getUrlArgMap(s).redirect_uri),c=!0),/\?/i.test(t.link)?/tar_foid/.test(t.link)?t.link=t.link.replace(/tar_foid=[^\?\&\#]*/,"tar_foid="+i):t.link=t.link+"&tar_foid="+i:t.link=t.link+"?tar_foid="+i,c&&(t.link=s.replace(/redirect_uri=[^\?\&\#]*/,"redirect_uri="+encodeURIComponent(t.link))),t.link=tarCommon.removeUrlParam(t.link,"code"),t.link=tarCommon.removeUrlParam(t.link,"userinfo"),"friend"==a?t.link=t.link+"&from=singlemessage":"timeline"==a?t.link=t.link+"&from=timeline":"qq"==a?t.link=t.link+"&from=qq":"qzone"==a&&(t.link=t.link+"&from=qzone"),console.log("share shape data start"),t};this.postEncrypt=function(postdata){tarCommon.debug("TarWXShare postEncrypt start",postdata),Ajax.request(tarCommon.encrypturl,{method:"POST",data:postdata,success:function(r){var ret=eval("("+r.response+")");tarCommon.debug("encrypt success","ok"),tar_encrypt=ret.encrypt,tar_sharedata=ret.sharedata,tar_sign=ret.sign,tar_timestamp=ret.timestamp,tarCommon.tar_channel=ret.tar_channel},failure:function(t){tarCommon.debug("encrypt failure",t)}})},this.base64Decode=function(t){if(t){var a=tarCommon.str_replace(["-","_"," "],["+","/","="],t);return userinfo_str=tarCommon.utf8to16(tarCommon.base64decode(a)),userinfo=JSON.parse(userinfo_str),userinfo}return new Object}}module.exports=TarWXShare},function(t,a){function e(t){var a=t.Ajax,e="",r="",n="",o="1",i="",s="",c=t.tar_channel||"";this.init=function(){e=t.tar_event,r=t.tar_oid,n=t.tar_foid;var a=window.location.href,u=window.location.hash;if(a=a.substr(0,a.length-u.length),a=/\?/i.test(a)?/tar_foid/.test(a)?a.replace(/tar_foid=[^\?\&\#]*/,"tar_foid="+r):a+"&tar_foid="+r:a+"?tar_foid="+r,window.history.pushState){var l=c&&-1===a.indexOf("tar_channel")?"&tar_channel="+c:"";window.history.pushState({},null,a+l+u)}s=document.referrer,i=/urlshare/i.test(s)?"qzone":/QQ/i.test(navigator.userAgent)?"qq":"pc";var d="tar-fuuid-"+e;return n=window.localStorage.getItem(d),o="1",t.debug("TarOTShare init","openid: "+r+"\nfopenid: "+n),this.submitAccess(),!0},this.submitAccess=function(){var c=t.tar_url,u=t.tar_width,l=t.tar_height,d=t.tar_channel||"",_=t.tar_token,h=t.tar_key;void 0!==n&&null!=n&&""!=n||(n="root"),void 0!==r&&null!=r||(r=""),void 0!==i&&null!=i||(i=""),void 0!==c&&null!=c||(c=""),void 0!==s&&null!=s||(s=""),void 0!==u&&null!=u||(u=""),void 0!==l&&null!=l||(l="");var m={tar_uuid:o,tar_event:e,tar_oid:r,tar_foid:n,tar_nickname:"",tar_sex:"",tar_province:"",tar_city:"",tar_country:"",tar_headimgurl:"",tar_from:i,tar_unionid:"",tar_url:c,tar_refer:s,tar_width:u,tar_height:l,tar_nettype:"",tar_channel:d,tar_token:_,tar_epkey:h};t.debug("TarOTShare submitAccess",m),t.loadSword(),a.request(t.posturlnew,{method:"POST",data:m,success:function(a){console.log("submitAccess over"),t.cb_ready&&t.cb_ready()}})}}t.exports=e},function(module,exports){function TarPage(tarCommon){var Ajax=tarCommon.Ajax,tar_oid="",tar_event="",tar_init_time="",tar_slb_domain="",tar_token="";this.init=function(){tar_event=tarCommon.tar_event,tar_init_time=tarCommon.tar_init_time,tar_slb_domain=tarCommon.tar_slb_domain,this.__setUnloadMo()},this.__setUnloadMo=function(){var unloadfun=window.onunload,sendStay=function(){if(unloadfun&&"function"==typeof unloadfun){var unloadfun_string=unloadfun.toString();unloadfun=eval("new "+unloadfun_string),"function"==typeof unloadfun&&unloadfun()}tar_oid=tarCommon.tar_oid,tar_token=tarCommon.tar_token,tar_stay_time=new Date-tar_init_time;var postdata={tar_event:tar_event,tar_oid:tar_oid,tar_stay:tar_stay_time,tar_token:tar_token,tar_epkey:tarCommon.tar_key};tarCommon.tar_type&&(tarCommon.tar_wxArticle_data.height=document.querySelector("body").offsetHeight,postdata.tar_article=JSON.stringify(tarCommon.tar_wxArticle_data)),tarCommon.debug("TarPage unload",postdata),Ajax.request(tarCommon.sendStayurl,{async:!1,method:"POST",data:postdata})};window.onunload=sendStay},this.subscribeClick=function(Id){var element=document.getElementById(Id);if(null==element)return void alert("Fatal Error: wrong ID "+Id+"!");var onclickfun=element.onclick,elementClick=function(){if(onclickfun&&"function"==typeof onclickfun){var onclickfun_string=onclickfun.toString();onclickfun=eval("new "+onclickfun_string),"function"==typeof onclickfun&&onclickfun()}this.hitTag("click",Id)};element.onclick=elementClick},this.subscribeTouchstart=function(Id){var element=document.getElementById(Id);if(null==element)return void alert("Fatal Error: wrong ID "+Id+"!");var ontouchstartfun=element.ontouchstart,elementTouchstart=function(){if(ontouchstartfun&&"function"==typeof ontouchstartfun){var ontouchstartfun_string=ontouchstartfun.toString();ontouchstartfun=eval("new "+ontouchstartfun_string),"function"==typeof ontouchstartfun&&ontouchstartfun()}this.hitTag("touchstart",Id)};element.ontouchstart=elementTouchstart},this.subscribeTouchmove=function(Id){var element=document.getElementById(Id);if(null==element)return void alert("Fatal Error: wrong ID "+Id+"!");var ontouchmovefun=element.ontouchmove,elementTouchmove=function(){if(ontouchmovefun&&"function"==typeof ontouchmovefun){var ontouchmovefun_string=ontouchmovefun.toString();ontouchmovefun=eval("new "+ontouchmovefun_string),"function"==typeof ontouchmovefun&&ontouchmovefun()}this.hitTag("touchmove",Id)};element.ontouchmove=elementTouchmove},this.subscribeTouchend=function(Id){var element=document.getElementById(Id);if(null==element)return void alert("Fatal Error: wrong ID "+Id+"!");var ontouchendfun=element.ontouchend,elementTouchend=function(){if(ontouchendfun&&"function"==typeof ontouchendfun){var ontouchendfun_string=ontouchendfun.toString();ontouchendfun=eval("new "+ontouchendfun_string),"function"==typeof ontouchendfun&&ontouchendfun()}this.hitTag("touchend",Id)};element.ontouchend=elementTouchend},this.hitTag=function(t,a){tar_oid=tarCommon.tar_oid,tarCommon.debug("TarPage hitTag",tar_event+"\n"+tar_oid+"\n"+t+"\n"+a),Ajax.request(tarCommon.hitTagurl,{method:"POST",data:{tar_event:tar_event,tar_oid:tar_oid,tar_key:t,tar_value:a,tar_channel:tarCommon.tar_channel,tar_token:tarCommon.tar_token,tar_epkey:tarCommon.tar_key}})}}module.exports=TarPage}]);